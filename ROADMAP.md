# TinyPascal Development Roadmap

**üéØ Goal: Complete Modern Pascal Implementation (Excluding OOP)**

## ‚úÖ Completed Features

### Core Infrastructure
- [x] **UTF-8 Lexer** - Complete tokenizer with full Pascal syntax support
- [x] **Recursive Descent Parser** - Full expression parsing with proper precedence
- [x] **AST System** - Complete Abstract Syntax Tree with Visitor pattern
- [x] **Type System** - Int64, UInt64, Float64, String, Boolean with conversions
- [x] **Bytecode Engine** - Complete instruction set and bytecode generation
- [x] **Virtual Machine** - Stack-based VM with full instruction execution
- [x] **X64 Compilation** - Proof of concept native compilation with in-memory execution
- [x] **Runtime System** - Built-in functions and native runtime support

### Language Features
- [x] **Program Structure** - `program ProgramName; ... end.`
- [x] **Variable Declarations** - `var x: Int; y: Float; s: String;`
- [x] **Basic Types** - Int (Int64), UInt (UInt64), Float (Double), String (UTF-8), Boolean
- [x] **Literals** - Integer, float, string, boolean literals
- [x] **Arithmetic Operators** - `+`, `-`, `*`, `/` with proper precedence
- [x] **Comparison Operators** - `=`, `<>`, `<`, `<=`, `>`, `>=`
- [x] **Logical Operators** - `and`, `or`, `not`
- [x] **Assignment** - `:=` operator
- [x] **Expressions** - Complex nested expressions with parentheses
- [x] **Control Flow** - `if/then/else`, `while/do`, `for/to/do`
- [x] **Built-in Functions** - `PrintLn`, `Print`, `IntToStr`, `StrToInt`, `FloatToStr`, `StrToFloat`
- [x] **Comments** - `//`, `{ }`, `(* *)` style comments

### Array Support (New!)
- [x] **Static Arrays** - `array[1..10] of Int`
- [x] **Dynamic Arrays** - `array of Int` (declaration and Length() working)
- [x] **Array Literals** - `[1, 2, 3, 4, 5]`
- [x] **Array Element Access** - `arr[index]` for reading elements
- [x] **Array Element Assignment** - `arr[index] := value`
- [x] **Length() Function** - Get array size with `Length(arr)`

### Development Tools
- [x] **Comprehensive Test Suite** - 27+ test cases covering all features
- [x] **Bytecode Disassembler** - Debug and inspect generated bytecode
- [x] **Error Handling** - Parse errors with line/column information
- [x] **Performance Tracking** - VM execution statistics

---

## üöß In Progress
- [ ] **Current Session Focus** - *To be updated based on current work*

---

## üìã Planned Features

### Phase 1: Data Types & Collections üèóÔ∏è

#### Arrays (Partial - Core Features Working)
- [ ] **Multi-dimensional Arrays** - `array[1..5, 1..10] of Int`
- [ ] **Array Operations** - Assignment (`arr1 := arr2`), comparison, slicing
- [ ] **Dynamic Array Functions** - `SetLength`, `High`, `Low`

#### Records/Structures
- [ ] **Record Types** - `type Person = record Name: String; Age: Int; end;`
- [ ] **Record Variables** - Declaration and field access
- [ ] **Nested Records** - Records containing other records
- [ ] **Record Assignment** - Deep copy semantics
- [ ] **With Statements** - `with Person do begin Name := 'John'; end;`

#### Enumerations
- [ ] **Enum Types** - `type Color = (Red, Green, Blue);`
- [ ] **Enum Variables** - Declaration and assignment
- [ ] **Enum Operations** - Ord, Succ, Pred functions
- [ ] **Enum Ranges** - `Red..Blue`

#### Sets
- [ ] **Set Types** - `set of Color`
- [ ] **Set Operations** - Union (`+`), intersection (`*`), difference (`-`)
- [ ] **Set Membership** - `in` operator
- [ ] **Set Literals** - `[Red, Green]`

### Phase 2: Enhanced Control Flow üîÑ

#### Case Statements
- [ ] **Integer Case** - `case x of 1: ...; 2: ...; else ...; end;`
- [ ] **Character Case** - Case on character values
- [ ] **Enum Case** - Case on enumeration values
- [ ] **String Case** - Case on string values (modern Pascal)
- [ ] **Range Cases** - `1..5: ...;`

#### Advanced Loops
- [ ] **Repeat..Until** - `repeat ... until condition;`
- [ ] **For..In Loops** - `for item in array do ...` (modern Pascal)
- [ ] **Break Statement** - Exit loop early
- [ ] **Continue Statement** - Skip to next iteration
- [ ] **Exit Statement** - Exit from procedure/function

### Phase 3: User-Defined Routines üìö

#### Procedures
- [ ] **Procedure Declaration** - `procedure DoSomething;`
- [ ] **Parameters** - Value parameters (`x: Int`)
- [ ] **Var Parameters** - Reference parameters (`var x: Int`)
- [ ] **Const Parameters** - Read-only parameters (`const x: Int`)
- [ ] **Local Variables** - Local var declarations
- [ ] **Nested Procedures** - Procedures inside procedures

#### Functions
- [ ] **Function Declaration** - `function Add(a, b: Int): Int;`
- [ ] **Return Values** - `Result` variable and explicit returns
- [ ] **Function Calls** - In expressions and statements
- [ ] **Recursive Functions** - Self-calling functions

#### Advanced Routine Features
- [ ] **Function Overloading** - Same name, different parameters
- [ ] **Default Parameters** - `procedure Test(x: Int = 10);`
- [ ] **Variable Parameters** - `array of const` support
- [ ] **Inline Functions** - `inline` directive (modern Pascal)

### Phase 4: Constants & Advanced Types üîß

#### Constants
- [ ] **Typed Constants** - `const Pi: Float = 3.14159;`
- [ ] **Untyped Constants** - `const MaxItems = 100;`
- [ ] **Array Constants** - `const Colors: array[1..3] of String = ('Red', 'Green', 'Blue');`
- [ ] **Record Constants** - Constant record initialization

#### Pointers
- [ ] **Pointer Types** - `^Int`, `Pointer`
- [ ] **Pointer Operations** - `@` (address of), `^` (dereference)
- [ ] **Dynamic Memory** - `New`, `Dispose`, `GetMem`, `FreeMem`
- [ ] **Nil Pointer** - `nil` constant

#### Advanced Types
- [ ] **Type Aliases** - `type TInteger = Int;`
- [ ] **Subrange Types** - `type TDigit = 0..9;`
- [ ] **Variant Records** - Records with variant parts

### Phase 5: String Enhancements üìù

#### String Operations
- [ ] **String Concatenation** - `+` operator for strings
- [ ] **String Indexing** - `s[1]` for character access
- [ ] **String Functions** - `Length`, `Copy`, `Pos`, `Delete`, `Insert`
- [ ] **String Comparison** - Case-sensitive and case-insensitive
- [ ] **String Formatting** - `Format` function
- [ ] **String Interpolation** - Modern string formatting (if desired)

#### Character Handling
- [ ] **Char Type** - Single character type
- [ ] **Character Functions** - `UpCase`, `Chr`, `Ord`
- [ ] **Character Sets** - Character classification

### Phase 6: File I/O & System üíæ

#### File Operations
- [ ] **Text Files** - `TextFile` type and operations
- [ ] **Binary Files** - `File` type for binary data
- [ ] **File Functions** - `Assign`, `Reset`, `Rewrite`, `Close`
- [ ] **File I/O** - `ReadLn`, `WriteLn`, `Read`, `Write` for files
- [ ] **File Status** - `EOF`, `IOResult` functions

#### System Functions
- [ ] **Date/Time** - `Now`, `Date`, `Time` functions
- [ ] **Math Functions** - `Sin`, `Cos`, `Sqrt`, `Abs`, `Round`, `Trunc`
- [ ] **Random Numbers** - `Random`, `Randomize`
- [ ] **System Info** - `ParamCount`, `ParamStr`

### Phase 7: Error Handling üõ°Ô∏è

#### Exception Handling
- [ ] **Try..Except** - `try ... except ... end;`
- [ ] **Try..Finally** - `try ... finally ... end;`
- [ ] **Raise Statement** - `raise Exception.Create('Error');`
- [ ] **Exception Types** - Built-in exception hierarchy
- [ ] **Exception Information** - Message, stack trace

### Phase 8: Advanced Language Features üöÄ

#### Generics (Without Classes)
- [ ] **Generic Procedures** - `procedure Test<T>(x: T);`
- [ ] **Generic Functions** - `function Max<T>(a, b: T): T;`
- [ ] **Generic Types** - `type TArray<T> = array of T;`
- [ ] **Type Constraints** - Constraining generic parameters

#### Anonymous Functions
- [ ] **Anonymous Procedures** - `procedure(x: Int) begin ... end`
- [ ] **Anonymous Functions** - `function(x: Int): Int begin Result := x * 2; end`
- [ ] **Lambda Expressions** - Simplified syntax

#### Modern Syntax
- [ ] **Inline Variables** - `var x := 10;` (type inference)
- [ ] **For..In with Index** - `for var i := Low(arr) to High(arr) do`
- [ ] **Multiple Assignment** - If feasible
- [ ] **String Case Insensitive** - Case statements on strings

### Phase 9: Units & Modularity üì¶

#### Unit System
- [ ] **Unit Declaration** - `unit MyUnit;`
- [ ] **Interface Section** - Public declarations
- [ ] **Implementation Section** - Private implementation
- [ ] **Uses Clause** - Unit dependencies
- [ ] **Unit Initialization** - Initialization/finalization sections

#### Conditional Compilation
- [ ] **Compiler Directives** - `{$IFDEF}`, `{$IFNDEF}`, `{$ELSE}`, `{$ENDIF}`
- [ ] **Compiler Defines** - Built-in and custom defines
- [ ] **Platform Directives** - Platform-specific compilation

### Phase 10: Performance & Optimization ‚ö°

#### Compiler Optimizations
- [ ] **Constant Folding** - Compile-time expression evaluation
- [ ] **Dead Code Elimination** - Remove unused code
- [ ] **Inline Expansion** - Inline function calls
- [ ] **Loop Optimizations** - Optimize loop constructs

#### Native Compilation Enhancements
- [ ] **Complete X64 Backend** - Full instruction set support
- [ ] **Resource Embedding** - Embed compiled code in host executables
- [ ] **Runtime Code Loading** - Load and execute machine code from files/resources
- [ ] **Calling Convention Support** - Multiple calling conventions
- [ ] **Host Integration** - Seamless integration with host applications

---

## üéØ Development Priorities

### Phase Priority Order
1. **Phase 1 (Data Types)** - Foundation for complex programs
2. **Phase 3 (User Routines)** - Essential for any real programming
3. **Phase 2 (Control Flow)** - Enhanced program structure
4. **Phase 4 (Constants/Types)** - Advanced type system
5. **Phase 5 (Strings)** - Better text handling
6. **Phase 6 (File I/O)** - System integration
7. **Phase 7 (Exceptions)** - Robust error handling
8. **Phase 8 (Advanced)** - Modern language features
9. **Phase 9 (Units)** - Large program organization
10. **Phase 10 (Optimization)** - Performance improvements

### Immediate Next Steps (Recommendations)
1. **Records** - Essential data structures (arrays mostly done)
2. **User-defined Procedures/Functions** - Enable modular programming
3. **Case Statements** - Common control structure
4. **Advanced Array Operations** - Complete array functionality

---

## üìù Notes

### Design Decisions
- **No OOP** - Focus on procedural/functional programming
- **UTF-8 Strings** - Modern text handling
- **Strong Typing** - Type safety with explicit conversions
- **Modern Pascal Syntax** - Include beneficial modern features
- **Performance** - Both bytecode VM and native compilation support

### Testing Strategy
- Add comprehensive tests for each new feature
- Maintain existing test coverage
- Performance benchmarks for major features
- Cross-platform compatibility (where applicable)

### Documentation
- Update this TODO after each session
- Document new language features
- Provide examples for each feature
- Maintain syntax reference

---

**Last Updated:** June 2025  
**Current Focus:** Arrays implemented (core functionality working)  
**Next Session:** Records/Structures or User-Defined Procedures